<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .menu-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
            pointer-events: auto;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            margin: 0;
            font-size: 1.2em;
        }

        .close-sidebar {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 20px;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .sidebar-content {
            padding: 20px;
        }

        .sidebar-employee-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .sidebar-employee-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .sidebar-employee-item.active {
            background: #f0f4ff;
            border-left-color: #667eea;
        }

        .sidebar-employee-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .sidebar-employee-salary {
            font-size: 0.9em;
            color: #666;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            pointer-events: none;
        }

        .overlay.show {
            display: block;
            pointer-events: auto;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tfoot {
            background: #f8f9fa;
            font-weight: bold;
        }

        tfoot td {
            border-top: 2px solid #667eea;
            padding: 15px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .summary-card h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .summary-row:last-child {
            border-bottom: none;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-advance {
            background: #fff3cd;
            color: #856404;
        }

        .badge-leave {
            background: #d1ecf1;
            color: #0c5460;
        }

        .negative-amount {
            color: #e74c3c;
            font-weight: bold;
        }

        .badge-employee {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            margin: 5px;
            display: inline-block;
        }

        .employee-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .employee-item {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 200px;
        }

        .employee-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .employee-item-content {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .employee-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .employee-item.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .employee-name {
            font-weight: 600;
            color: #333;
        }

        .employee-item.active .employee-name {
            color: #667eea;
        }

        .current-employee {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .all-summary {
            background: #27ae60;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .all-summary h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .employee-item {
                min-width: 100%;
            }
        }

        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå */
        @media print {
            body {
                background: white !important;
            }
            
            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            
            .header {
                background: #667eea !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .btn, .menu-button, .close-sidebar, .overlay, .sidebar {
                display: none !important;
            }
            
            .section {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            .summary-card {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            table {
                page-break-inside: avoid;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
        <div class="container">
        <div class="header">
            <button class="menu-button" onclick="toggleSidebar()">‚ò∞</button>
            <h1>üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h1>
            <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</p>
        </div>

        <!-- Sidebar Menu -->
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</h3>
                <button class="close-sidebar" onclick="toggleSidebar()">‚úï</button>
            </div>
            <div class="sidebar-content" id="sidebarEmployeeList">
                <div class="empty-state">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>

        <div class="content">
            <!-- ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ -->
            <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                <h2 style="color: white; margin-bottom: 20px;">üõ†Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <button class="btn btn-success" onclick="exportToExcel()">üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel</button>
                    <button class="btn btn-success" onclick="exportToCSV()">üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
                    <button class="btn btn-primary" onclick="printSummary()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                    <button class="btn btn-primary" onclick="printAllSummary()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="btn btn-primary" onclick="printCurrentPage()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>
                    <button class="btn btn-primary" onclick="backupData()">üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn btn-primary" onclick="restoreData()">üì• ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn btn-primary" onclick="showStatistics()">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                    <button class="btn btn-primary" onclick="showSettings()">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </div>

            <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á -->
            <div class="section" id="searchSection">
                <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</label>
                        <input type="text" id="searchEmployee" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á..." onkeyup="filterEmployees()">
                    </div>
                    <div class="form-group">
                        <label>‡∏Å‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                        <input type="month" id="filterMonth" onchange="filterHistory()">
                    </div>
                </div>
            </div>

            <!-- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á -->
            <div class="section">
                <h2>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</label>
                        <input type="text" id="employeeName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addEmployee()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</button>
                <button class="btn btn-success" onclick="addAllEmployeesWithSalary()">üìã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á</button>
                
                <div style="margin-top: 20px; padding: 15px; background: #e8f4f8; border-radius: 10px;">
                    <button class="btn btn-success" onclick="calculateMultipleEmployees()">üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</button>
                    <button class="btn btn-primary" onclick="selectAllEmployees()">‚òëÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="btn btn-primary" onclick="deselectAllEmployees()">‚òê ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
                
                <div class="employee-list" id="employeeList">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
            </div>

            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
            <div id="currentEmployeeSection" style="display: none;">
                <div class="current-employee">
                    üë§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: <span id="currentEmployeeName"></span>
                </div>
            
            <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á -->
            <div id="noEmployeeSelected" class="section" style="text-align: center; padding: 40px;">
                <h2 style="color: #667eea; margin-bottom: 20px;">üë• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</h2>
                <p style="color: #666; font-size: 1.1em; margin-bottom: 20px;">
                    ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° <strong>‚ò∞</strong> ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
                </p>
                <p style="color: #999; font-size: 0.9em;">
                    ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ
                </p>
            </div>

                <!-- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                <div class="section">
                    <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="dailySalary" value="500" min="0" step="0.01" onchange="updateEmployeeSettings()">
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                            <input type="number" id="workingDays" value="30" min="0" step="0.01" onchange="updateEmployeeSettings()">
                        </div>
                        <div class="form-group">
                            <label>‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="previousNegativeBalance" value="0" min="0" step="0.01" onchange="updateEmployeeSettings()" placeholder="0.00">
                            <small style="color: #666; font-size: 0.85em;">‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</small>
                        </div>
                    </div>
                </div>

                <!-- ‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô -->
                <div class="section">
                    <h2>üíµ ‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</label>
                            <input type="date" id="advanceDate">
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="advanceAmount" min="0" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" id="advanceNote" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addAdvance()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</button>
                </div>

                <!-- ‡∏•‡∏≤‡∏á‡∏≤‡∏ô -->
                <div class="section">
                    <h2>üèñÔ∏è ‡∏•‡∏≤‡∏á‡∏≤‡∏ô</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</label>
                            <input type="date" id="leaveDate">
                        </div>
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                            <select id="leaveType">
                                <option value="sick">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                                <option value="personal">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                                <option value="vacation">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô</option>
                                <option value="unpaid">‡∏•‡∏≤‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô</option>
                                <option value="halfday">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" id="leaveNote" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addLeave()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏≤</button>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô -->
                <div class="section">
                    <h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>
                    <div class="table-container">
                        <table id="advanceTable">
                            <thead>
                                <tr>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="advanceTableBody">
                                <tr>
                                    <td colspan="4" class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô -->
                <div class="section">
                    <h2>üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô</h2>
                    <div class="table-container">
                        <table id="leaveTable">
                            <thead>
                                <tr>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="leaveTableBody">
                                <tr>
                                    <td colspan="4" class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô -->
                <div class="summary-card">
                    <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì - <span id="summaryEmployeeName"></span></h3>
                    <div class="summary-row">
                        <span>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô:</span>
                        <span id="summaryDailySalary">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</span>
                        <span id="summaryWorkingDays">0 ‡∏ß‡∏±‡∏ô</span>
                    </div>
                    <div class="summary-row">
                        <span>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°:</span>
                        <span id="summaryTotalSalary">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤:</span>
                        <span id="summaryLeaveDays">0 ‡∏ß‡∏±‡∏ô</span>
                    </div>
                    <div class="summary-row">
                        <span>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤:</span>
                        <span id="summaryLeaveDeduction">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏£‡∏ß‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô:</span>
                        <span id="summaryTotalAdvance">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="summary-row" id="amountBeforeNegativeRow" style="display: none;">
                        <span>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å):</span>
                        <span id="summaryAmountBeforeNegative">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="summary-row" id="previousNegativeRow" style="display: none;">
                        <span>‚ûñ ‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô:</span>
                        <span id="summaryPreviousNegative" class="negative-amount">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="summary-row" id="calculationRow" style="display: none; font-style: italic; color: #666;">
                        <span>üìê ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</span>
                        <span id="calculationText"></span>
                    </div>
                    <div class="summary-row">
                        <span>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢:</span>
                        <span id="summaryFinalAmount">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn btn-success" onclick="saveHistory()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                        <button class="btn btn-primary" onclick="printSummary()" style="margin: 5px;">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ</button>
                        <button class="btn btn-success" onclick="resetNegativeBalance()" id="resetNegativeBtn" style="display: none;">‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß)</button>
                    </div>
                </div>
            </div>

            <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
            <div class="section" id="historySection" style="display: none;">
                <h2>üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                <div class="table-container">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</th>
                                <th>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</th>
                                <th>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏•‡∏≤</th>
                                <th>‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                                <th>‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th>‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÄ‡∏Å‡πà‡∏≤</th>
                                <th>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="10" class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô -->
            <div class="section" id="multipleSummarySection" style="display: none;">
                <h2>üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô</h2>
                <div class="table-container">
                    <table id="multipleSummaryTable">
                        <thead>
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</th>
                                <th>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏•‡∏≤</th>
                                <th>‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
                                <th>‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th>‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÄ‡∏Å‡πà‡∏≤</th>
                                <th>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢</th>
                            </tr>
                        </thead>
                        <tbody id="multipleSummaryTableBody">
                        </tbody>
                        <tfoot>
                            <tr style="background: #f8f9fa; font-weight: bold;">
                                <td colspan="8" style="text-align: right;">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</td>
                                <td id="multipleSummaryTotal" style="color: #27ae60; font-size: 1.1em;">0.00 ‡∏ö‡∏≤‡∏ó</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
            <div class="all-summary" id="allSummarySection" style="display: none;">
                <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <div id="allSummaryContent"></div>
                <div class="summary-row">
                    <span>üí∞ ‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="allSummaryTotal">0.00 ‡∏ö‡∏≤‡∏ó</span>
                </div>
            </div>

            <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô -->
            <div class="section" id="statisticsSection" style="display: none;">
                <h2>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ</label>
                        <select id="statYear" onchange="updateStatistics()">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</label>
                        <select id="statEmployee" onchange="updateStatistics()">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                </div>
                <div id="statisticsContent"></div>
            </div>

            <!-- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
            <div class="section" id="settingsSection" style="display: none;">
                <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="defaultDailySalary" value="500" min="0" step="0.01" onchange="saveSettings()">
                    </div>
                    <div class="form-group">
                        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="number" id="defaultWorkingDays" value="30" min="0" step="0.01" onchange="saveSettings()">
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h3>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyNegative" onchange="saveSettings()">
                            ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyOverAdvance" onchange="saveSettings()">
                            ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Import -->
    <div id="importModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
            <h2>üì• ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <p style="margin: 15px 0; color: #666;">‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            <div class="form-group">
                <label>‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ:</label>
                <textarea id="importData" rows="10" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: monospace;"></textarea>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-primary" onclick="confirmRestore()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</button>
                <button class="btn btn-danger" onclick="closeImportModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let employees = {}; // { id: { name, dailySalary, workingDays, advances: [], leaves: [] } }
        let currentEmployeeId = null;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
        function loadData() {
            const saved = localStorage.getItem('employees');
            if (saved) {
                employees = JSON.parse(saved);
            } else {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á
                initializeDefaultEmployees();
            }
            updateEmployeeList();
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á
        function initializeDefaultEmployees() {
            const employeeData = [
                { name: '‡∏ô‡∏û', salary: 700 },
                { name: '‡∏´‡∏ß‡∏±‡∏á', salary: 550 },
                { name: '‡∏Ñ‡∏≥', salary: 450 },
                { name: '‡πÇ‡∏Å‡πä‡∏∞', salary: 300 },
                { name: '‡∏ï‡πâ‡∏≠‡∏°', salary: 450 },
                { name: '‡∏ö‡∏±‡∏ï‡∏£', salary: 600 },
                { name: '‡πÄ‡∏ó‡πà‡∏á', salary: 700 },
                { name: '‡∏ß‡∏±‡∏ô', salary: 500 },
                { name: '‡∏≠‡∏≤‡∏ó', salary: 700 },
                { name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢', salary: 600 },
                { name: '‡∏ô‡∏¥‡∏î', salary: 400 },
                { name: '‡∏à‡∏±‡∏ô', salary: 600 },
                { name: '‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß', salary: 500 },
                { name: '‡∏´‡∏ô‡∏∂‡πà‡∏á', salary: 500 }
            ];

            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            const defaultWorkingDays = settings.defaultWorkingDays || 30;

            employeeData.forEach((emp, index) => {
                const id = Date.now() + index;
                employees[id] = {
                    name: emp.name,
                    dailySalary: emp.salary,
                    workingDays: defaultWorkingDays,
                    advances: [],
                    leaves: [],
                    previousNegativeBalance: 0,
                    history: []
                };
            });

            saveData();
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function saveData() {
            localStorage.setItem('employees', JSON.stringify(employees));
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á
        function addEmployee() {
            const name = document.getElementById('employeeName').value.trim();
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á');
                return;
            }

            // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å settings
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            const defaultDailySalary = settings.defaultDailySalary || 500;
            const defaultWorkingDays = settings.defaultWorkingDays || 30;

            const id = Date.now();
            employees[id] = {
                name: name,
                dailySalary: defaultDailySalary,
                workingDays: defaultWorkingDays,
                advances: [],
                leaves: [],
                previousNegativeBalance: 0, // ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                history: [] // ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            };

            document.getElementById('employeeName').value = '';
            saveData();
            updateEmployeeList();
            selectEmployee(id);
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á
        function addAllEmployeesWithSalary() {
            if (Object.keys(employees).length > 0) {
                if (!confirm('‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ã‡πâ‡∏≥‡∏ä‡∏∑‡πà‡∏≠)')) {
                    return;
                }
            }

            const employeeData = [
                { name: '‡∏ô‡∏û', salary: 700 },
                { name: '‡∏´‡∏ß‡∏±‡∏á', salary: 550 },
                { name: '‡∏Ñ‡∏≥', salary: 450 },
                { name: '‡πÇ‡∏Å‡πä‡∏∞', salary: 300 },
                { name: '‡∏ï‡πâ‡∏≠‡∏°', salary: 450 },
                { name: '‡∏ö‡∏±‡∏ï‡∏£', salary: 600 },
                { name: '‡πÄ‡∏ó‡πà‡∏á', salary: 700 },
                { name: '‡∏ß‡∏±‡∏ô', salary: 500 },
                { name: '‡∏≠‡∏≤‡∏ó', salary: 700 },
                { name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢', salary: 600 },
                { name: '‡∏ô‡∏¥‡∏î', salary: 400 },
                { name: '‡∏à‡∏±‡∏ô', salary: 600 },
                { name: '‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß', salary: 500 },
                { name: '‡∏´‡∏ô‡∏∂‡πà‡∏á', salary: 500 }
            ];

            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            const defaultWorkingDays = settings.defaultWorkingDays || 30;

            let addedCount = 0;
            employeeData.forEach(emp => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const existing = Object.values(employees).find(e => e.name === emp.name);
                if (!existing) {
                    const id = Date.now() + Math.random();
                    employees[id] = {
                        name: emp.name,
                        dailySalary: emp.salary,
                        workingDays: defaultWorkingDays,
                        advances: [],
                        leaves: [],
                        previousNegativeBalance: 0,
                        history: []
                    };
                    addedCount++;
                }
            });

            saveData();
            updateEmployeeList();
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ${addedCount} ‡∏Ñ‡∏ô`);
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á
        function addAllEmployeesWithSalary() {
            if (Object.keys(employees).length > 0) {
                if (!confirm('‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥)')) {
                    return;
                }
            }

            const employeeData = [
                { name: '‡∏ô‡∏û', salary: 700 },
                { name: '‡∏´‡∏ß‡∏±‡∏á', salary: 550 },
                { name: '‡∏Ñ‡∏≥', salary: 450 },
                { name: '‡πÇ‡∏Å‡πä‡∏∞', salary: 300 },
                { name: '‡∏ï‡πâ‡∏≠‡∏°', salary: 450 },
                { name: '‡∏ö‡∏±‡∏ï‡∏£', salary: 600 },
                { name: '‡πÄ‡∏ó‡πà‡∏á', salary: 700 },
                { name: '‡∏ß‡∏±‡∏ô', salary: 500 },
                { name: '‡∏≠‡∏≤‡∏ó', salary: 700 },
                { name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢', salary: 600 },
                { name: '‡∏ô‡∏¥‡∏î', salary: 400 },
                { name: '‡∏à‡∏±‡∏ô', salary: 600 },
                { name: '‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß', salary: 500 },
                { name: '‡∏´‡∏ô‡∏∂‡πà‡∏á', salary: 500 }
            ];

            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            const defaultWorkingDays = settings.defaultWorkingDays || 30;

            let addedCount = 0;
            employeeData.forEach((emp, index) => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const existing = Object.values(employees).find(e => e.name === emp.name);
                if (!existing) {
                    const id = Date.now() + index + Math.random();
                    employees[id] = {
                        name: emp.name,
                        dailySalary: emp.salary,
                        workingDays: defaultWorkingDays,
                        advances: [],
                        leaves: [],
                        previousNegativeBalance: 0,
                        history: []
                    };
                    addedCount++;
                }
            });

            saveData();
            updateEmployeeList();
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ${addedCount} ‡∏Ñ‡∏ô`);
        }

        // ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á
        function deleteEmployee(id) {
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${employees[id].name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                delete employees[id];
                if (currentEmployeeId === id) {
                    currentEmployeeId = null;
                    document.getElementById('currentEmployeeSection').style.display = 'none';
                    document.getElementById('noEmployeeSelected').style.display = 'block';
                }
                saveData();
                updateEmployeeList();
                updateAllSummary();
            }
        }

        // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á
        function updateEmployeeList() {
            const list = document.getElementById('employeeList');
            const ids = Object.keys(employees);

            if (ids.length === 0) {
                list.innerHTML = '<div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</div>';
                return;
            }

            list.innerHTML = ids.map(id => {
                const emp = employees[id];
                const isActive = currentEmployeeId === id ? 'active' : '';
                return `
                    <div class="employee-item ${isActive}">
                        <div class="employee-item-content" onclick="selectEmployee(${id})">
                            <input type="checkbox" class="employee-checkbox" id="checkbox_${id}" onclick="event.stopPropagation();">
                            <span class="employee-name">${emp.name}</span>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); deleteEmployee(${id})">üóëÔ∏è</button>
                    </div>
                `;
            }).join('');

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Sidebar
            updateSidebarEmployeeList();

            updateAllSummary();
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡πÉ‡∏ô Sidebar
        function updateSidebarEmployeeList() {
            const sidebarList = document.getElementById('sidebarEmployeeList');
            const ids = Object.keys(employees);

            if (ids.length === 0) {
                sidebarList.innerHTML = '<div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á</div>';
                return;
            }

            sidebarList.innerHTML = ids.map(id => {
                const emp = employees[id];
                const isActive = currentEmployeeId === id ? 'active' : '';
                const calculation = calculateEmployeeSalary(emp);
                return `
                    <div class="sidebar-employee-item ${isActive}" onclick="selectEmployeeFromSidebar('${id}')">
                        <div class="sidebar-employee-name">${emp.name}</div>
                        <div class="sidebar-employee-salary">
                            üí∞ ${formatCurrency(emp.dailySalary)}/‡∏ß‡∏±‡∏ô | 
                            üíµ ${formatCurrency(calculation.finalAmount)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á (helper function)
        function calculateEmployeeSalary(emp) {
            const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
            const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
            const totalSalary = emp.dailySalary * emp.workingDays;
            const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
            const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
            const previousNegative = emp.previousNegativeBalance || 0;
            const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
            const finalAmount = amountBeforeNegative - previousNegative;

            return {
                totalSalary,
                leaveDeduction,
                totalAdvance,
                previousNegative,
                amountBeforeNegative,
                finalAmount
            };
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å Sidebar
        function selectEmployeeFromSidebar(id) {
            selectEmployee(id);
            toggleSidebar(); // ‡∏õ‡∏¥‡∏î sidebar ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á
        function selectEmployee(id) {
            currentEmployeeId = id;
            const emp = employees[id];
            
            document.getElementById('currentEmployeeName').textContent = emp.name;
            document.getElementById('summaryEmployeeName').textContent = emp.name;
            document.getElementById('dailySalary').value = emp.dailySalary;
            document.getElementById('workingDays').value = emp.workingDays;
            document.getElementById('previousNegativeBalance').value = emp.previousNegativeBalance || 0;
            
            document.getElementById('currentEmployeeSection').style.display = 'block';
            const noEmployeeMsg = document.getElementById('noEmployeeSelected');
            if (noEmployeeMsg) {
                noEmployeeMsg.style.display = 'none';
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (!emp.history) {
                emp.history = [];
            }
            updateHistoryTable();
            
            updateTables();
            updateSummary();
            updateEmployeeList();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á
        function updateEmployeeSettings() {
            if (!currentEmployeeId) return;
            
            const emp = employees[currentEmployeeId];
            emp.dailySalary = parseFloat(document.getElementById('dailySalary').value) || 0;
            emp.workingDays = parseFloat(document.getElementById('workingDays').value) || 30;
            emp.previousNegativeBalance = parseFloat(document.getElementById('previousNegativeBalance').value) || 0;
            
            saveData();
            updateSummary();
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô
        function addAdvance() {
            if (!currentEmployeeId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const date = document.getElementById('advanceDate').value;
            const amount = parseFloat(document.getElementById('advanceAmount').value);
            const note = document.getElementById('advanceNote').value;

            if (!date) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                return;
            }

            if (!amount || amount <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            employees[currentEmployeeId].advances.push({
                id: Date.now(),
                date: date,
                amount: amount,
                note: note || '‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô'
            });

            document.getElementById('advanceDate').value = '';
            document.getElementById('advanceAmount').value = '';
            document.getElementById('advanceNote').value = '';

            saveData();
            updateTables();
            updateSummary();
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏≤
        function addLeave() {
            if (!currentEmployeeId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const date = document.getElementById('leaveDate').value;
            const type = document.getElementById('leaveType').value;
            const note = document.getElementById('leaveNote').value;

            if (!date) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                return;
            }

            const typeNames = {
                'sick': '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢',
                'personal': '‡∏•‡∏≤‡∏Å‡∏¥‡∏à',
                'vacation': '‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô',
                'unpaid': '‡∏•‡∏≤‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô',
                'halfday': '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô'
            };

            employees[currentEmployeeId].leaves.push({
                id: Date.now(),
                date: date,
                type: type,
                typeName: typeNames[type],
                note: note || typeNames[type],
                isHalfDay: type === 'halfday'
            });

            document.getElementById('leaveDate').value = '';
            document.getElementById('leaveNote').value = '';

            saveData();
            updateTables();
            updateSummary();
        }

        // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô
        function deleteAdvance(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                const emp = employees[currentEmployeeId];
                emp.advances = emp.advances.filter(a => a.id !== id);
                saveData();
                updateTables();
                updateSummary();
            }
        }

        // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤
        function deleteLeave(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                const emp = employees[currentEmployeeId];
                emp.leaves = emp.leaves.filter(l => l.id !== id);
                saveData();
                updateTables();
                updateSummary();
            }
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô
        function updateAdvanceTable() {
            if (!currentEmployeeId) return;
            
            const tbody = document.getElementById('advanceTableBody');
            const emp = employees[currentEmployeeId];
            const advances = emp.advances;
            
            if (advances.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</td></tr>';
                return;
            }

            tbody.innerHTML = advances.map(advance => `
                <tr>
                    <td>${formatDate(advance.date)}</td>
                    <td>${formatCurrency(advance.amount)}</td>
                    <td>${advance.note}</td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="deleteAdvance(${advance.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                    </td>
                </tr>
            `).join('');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤
        function updateLeaveTable() {
            if (!currentEmployeeId) return;
            
            const tbody = document.getElementById('leaveTableBody');
            const emp = employees[currentEmployeeId];
            const leaves = emp.leaves;
            
            if (leaves.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤</td></tr>';
                return;
            }

            tbody.innerHTML = leaves.map(leave => {
                const isHalfDay = leave.isHalfDay || leave.type === 'halfday';
                const badgeText = isHalfDay ? `${leave.typeName} (¬Ω ‡∏ß‡∏±‡∏ô)` : leave.typeName;
                return `
                <tr>
                    <td>${formatDate(leave.date)}</td>
                    <td><span class="badge badge-leave">${badgeText}</span></td>
                    <td>${leave.note}</td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="deleteLeave(${leave.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                    </td>
                </tr>
            `;
            }).join('');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function updateTables() {
            updateAdvanceTable();
            updateLeaveTable();
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô
        function updateSummary() {
            if (!currentEmployeeId) return;
            
            const emp = employees[currentEmployeeId];
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ isHalfDay)
            const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô
            const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
            const totalLeaveDays = emp.leaves.length;
            
            const totalSalary = emp.dailySalary * emp.workingDays;
            // ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô: ‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô = 1 ‡∏ß‡∏±‡∏ô, ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô = 0.5 ‡∏ß‡∏±‡∏ô
            const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
            const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
            // ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤)
            const previousNegative = emp.previousNegativeBalance || 0;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö
            const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
            // ‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
            const finalAmount = amountBeforeNegative - previousNegative;

            document.getElementById('summaryDailySalary').textContent = formatCurrency(emp.dailySalary);
            document.getElementById('summaryWorkingDays').textContent = `${emp.workingDays} ‡∏ß‡∏±‡∏ô`;
            document.getElementById('summaryTotalSalary').textContent = formatCurrency(totalSalary);
            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° (‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô = 0.5 ‡∏ß‡∏±‡∏ô)
            const totalLeaveDaysDecimal = fullDayLeaves + (halfDayLeaves * 0.5);
            if (halfDayLeaves > 0) {
                document.getElementById('summaryLeaveDays').textContent = `${totalLeaveDaysDecimal} ‡∏ß‡∏±‡∏ô (‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô ${fullDayLeaves} ‡∏ß‡∏±‡∏ô, ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô ${halfDayLeaves} ‡∏ß‡∏±‡∏ô)`;
            } else {
                document.getElementById('summaryLeaveDays').textContent = `${totalLeaveDays} ‡∏ß‡∏±‡∏ô`;
            }
            document.getElementById('summaryLeaveDeduction').textContent = formatCurrency(leaveDeduction);
            document.getElementById('summaryTotalAdvance').textContent = formatCurrency(totalAdvance);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å)
            const amountBeforeNegativeRow = document.getElementById('amountBeforeNegativeRow');
            const amountBeforeNegativeElement = document.getElementById('summaryAmountBeforeNegative');
            if (previousNegative > 0) {
                amountBeforeNegativeRow.style.display = 'flex';
                amountBeforeNegativeElement.textContent = formatCurrency(amountBeforeNegative);
            } else {
                amountBeforeNegativeRow.style.display = 'none';
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
            const previousNegativeRow = document.getElementById('previousNegativeRow');
            const previousNegativeElement = document.getElementById('summaryPreviousNegative');
            const calculationRow = document.getElementById('calculationRow');
            const calculationText = document.getElementById('calculationText');
            
            if (previousNegative > 0) {
                previousNegativeRow.style.display = 'flex';
                previousNegativeElement.textContent = formatCurrency(previousNegative);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ - ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö = ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                calculationRow.style.display = 'flex';
                calculationText.textContent = `${formatCurrency(amountBeforeNegative)} - ${formatCurrency(previousNegative)} = ${formatCurrency(finalAmount)}`;
            } else {
                previousNegativeRow.style.display = 'none';
                calculationRow.style.display = 'none';
            }
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏´‡∏±‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
            // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ 500 - ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö 2,500 = -2,000
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏´‡∏°‡πà = 2,000 (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö)
            // ‡πÅ‡∏ï‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ü‡∏¥‡∏•‡∏î‡πå "‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô"
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó previousNegativeBalance ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
            // previousNegativeBalance ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ" ‡πÅ‡∏ó‡∏ô
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö
            const resetBtn = document.getElementById('resetNegativeBtn');
            if (previousNegative > 0 || finalAmount < 0) {
                resetBtn.style.display = 'inline-block';
            } else {
                resetBtn.style.display = 'none';
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏ö
            const finalAmountElement = document.getElementById('summaryFinalAmount');
            finalAmountElement.textContent = formatCurrency(finalAmount);
            if (finalAmount < 0) {
                finalAmountElement.classList.add('negative-amount');
            } else {
                finalAmountElement.classList.remove('negative-amount');
            }
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß)
        function resetNegativeBalance() {
            if (!currentEmployeeId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß)')) {
                const emp = employees[currentEmployeeId];
                emp.previousNegativeBalance = 0;
                saveData();
                updateSummary();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
        function saveHistory() {
            if (!currentEmployeeId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const emp = employees[currentEmployeeId];
            if (!emp.history) {
                emp.history = [];
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            const existingIndex = emp.history.findIndex(h => h.month === currentMonth);

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
            const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
            const totalLeaveDaysDecimal = fullDayLeaves + (halfDayLeaves * 0.5);
            const totalSalary = emp.dailySalary * emp.workingDays;
            const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
            const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
            const previousNegative = emp.previousNegativeBalance || 0;
            const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
            const finalAmount = amountBeforeNegative - previousNegative;

            const historyData = {
                id: Date.now(),
                month: currentMonth,
                monthName: `${now.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })}`,
                dailySalary: emp.dailySalary,
                workingDays: emp.workingDays,
                totalSalary: totalSalary,
                fullDayLeaves: fullDayLeaves,
                halfDayLeaves: halfDayLeaves,
                totalLeaveDays: emp.leaves.length,
                totalLeaveDaysDecimal: totalLeaveDaysDecimal,
                leaveDeduction: leaveDeduction,
                totalAdvance: totalAdvance,
                previousNegative: previousNegative,
                finalAmount: finalAmount,
                timestamp: now.toISOString()
            };

            if (existingIndex >= 0) {
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                if (confirm(`‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${historyData.monthName} ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                    emp.history[existingIndex] = historyData;
                    alert('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    return;
                }
            } else {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà
                emp.history.push(historyData);
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
            emp.history.sort((a, b) => b.month.localeCompare(a.month));

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥)
            // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó previousNegativeBalance ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            if (finalAmount < 0) {
                emp.previousNegativeBalance = Math.abs(finalAmount);
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß)
                emp.previousNegativeBalance = 0;
            }

            saveData();
            updateHistoryTable();
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        function updateHistoryTable() {
            if (!currentEmployeeId) {
                document.getElementById('historySection').style.display = 'none';
                return;
            }

            const emp = employees[currentEmployeeId];
            if (!emp.history || emp.history.length === 0) {
                document.getElementById('historySection').style.display = 'none';
                return;
            }

            document.getElementById('historySection').style.display = 'block';
            const tbody = document.getElementById('historyTableBody');

            tbody.innerHTML = emp.history.map(record => {
                const leaveDaysText = record.halfDayLeaves > 0
                    ? `${record.totalLeaveDaysDecimal} ‡∏ß‡∏±‡∏ô (${record.fullDayLeaves} ‡∏ß‡∏±‡∏ô, ¬Ω${record.halfDayLeaves} ‡∏ß‡∏±‡∏ô)`
                    : `${record.totalLeaveDays} ‡∏ß‡∏±‡∏ô`;

                const amountClass = record.finalAmount < 0 ? 'negative-amount' : '';
                const previousNegativeClass = record.previousNegative > 0 ? 'negative-amount' : '';

                return `
                    <tr>
                        <td><strong>${record.monthName}</strong></td>
                        <td>${formatCurrency(record.dailySalary)}</td>
                        <td>${record.workingDays} ‡∏ß‡∏±‡∏ô</td>
                        <td>${formatCurrency(record.totalSalary)}</td>
                        <td>${leaveDaysText}</td>
                        <td>${formatCurrency(record.leaveDeduction)}</td>
                        <td>${formatCurrency(record.totalAdvance)}</td>
                        <td class="${previousNegativeClass}">${record.previousNegative > 0 ? formatCurrency(record.previousNegative) : '-'}</td>
                        <td class="${amountClass}" style="font-weight: bold;">${formatCurrency(record.finalAmount)}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteHistory(${record.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        function deleteHistory(historyId) {
            if (!currentEmployeeId) return;

            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                const emp = employees[currentEmployeeId];
                if (emp.history) {
                    emp.history = emp.history.filter(h => h.id !== historyId);
                    saveData();
                    updateHistoryTable();
                }
            }
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function updateAllSummary() {
            const ids = Object.keys(employees);
            const summarySection = document.getElementById('allSummarySection');
            
            if (ids.length === 0) {
                summarySection.style.display = 'none';
                return;
            }

            summarySection.style.display = 'block';
            
            let totalAll = 0;
            const summaryContent = ids.map(id => {
                const emp = employees[id];
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ isHalfDay)
                const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô
                const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
                
                const totalSalary = emp.dailySalary * emp.workingDays;
                // ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô: ‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô = 1 ‡∏ß‡∏±‡∏ô, ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô = 0.5 ‡∏ß‡∏±‡∏ô
                const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
                const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
                // ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                const previousNegative = emp.previousNegativeBalance || 0;
                // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏î‡πâ
                const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
                const finalAmount = amountBeforeNegative - previousNegative;
                
                // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó previousNegativeBalance ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠ setInterval ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                // previousNegativeBalance ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                
                // ‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)
                totalAll += finalAmount;

                const amountClass = finalAmount < 0 ? 'negative-amount' : '';
                return `
                    <div class="summary-row">
                        <span>${emp.name}:</span>
                        <span class="${amountClass}">${formatCurrency(finalAmount)}</span>
                    </div>
                `;
            }).join('');

            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó previousNegativeBalance
            // ‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÜ

            document.getElementById('allSummaryContent').innerHTML = summaryContent;
            const totalElement = document.getElementById('allSummaryTotal');
            totalElement.textContent = formatCurrency(totalAll);
            if (totalAll < 0) {
                totalElement.classList.add('negative-amount');
            } else {
                totalElement.classList.remove('negative-amount');
            }
        }

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
        function calculateMultipleEmployees() {
            const ids = Object.keys(employees);
            const selectedIds = ids.filter(id => {
                const checkbox = document.getElementById(`checkbox_${id}`);
                return checkbox && checkbox.checked;
            });

            if (selectedIds.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô');
                return;
            }

            const tbody = document.getElementById('multipleSummaryTableBody');
            let totalAll = 0;

            tbody.innerHTML = selectedIds.map(id => {
                const emp = employees[id];
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô
                const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô
                const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
                const totalLeaveDays = emp.leaves.length;
                const totalLeaveDaysDecimal = fullDayLeaves + (halfDayLeaves * 0.5);
                
                const totalSalary = emp.dailySalary * emp.workingDays;
                // ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô: ‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô = 1 ‡∏ß‡∏±‡∏ô, ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô = 0.5 ‡∏ß‡∏±‡∏ô
                const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
                const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
                // ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                const previousNegative = emp.previousNegativeBalance || 0;
                // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏î‡πâ
                const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
                const finalAmount = amountBeforeNegative - previousNegative;
                
                // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó previousNegativeBalance ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                // previousNegativeBalance ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                
                totalAll += finalAmount;

                const amountClass = finalAmount < 0 ? 'negative-amount' : '';
                const leaveDaysText = halfDayLeaves > 0 
                    ? `${totalLeaveDaysDecimal} ‡∏ß‡∏±‡∏ô (${fullDayLeaves} ‡∏ß‡∏±‡∏ô, ¬Ω${halfDayLeaves} ‡∏ß‡∏±‡∏ô)`
                    : `${totalLeaveDays} ‡∏ß‡∏±‡∏ô`;

                const previousNegativeClass = previousNegative > 0 ? 'negative-amount' : '';
                return `
                    <tr>
                        <td><strong>${emp.name}</strong></td>
                        <td>${formatCurrency(emp.dailySalary)}</td>
                        <td>${emp.workingDays} ‡∏ß‡∏±‡∏ô</td>
                        <td>${formatCurrency(totalSalary)}</td>
                        <td>${leaveDaysText}</td>
                        <td>${formatCurrency(leaveDeduction)}</td>
                        <td>${formatCurrency(totalAdvance)}</td>
                        <td class="${previousNegativeClass}">${previousNegative > 0 ? formatCurrency(previousNegative) : '-'}</td>
                        <td class="${amountClass}" style="font-weight: bold; font-size: 1.1em;">${formatCurrency(finalAmount)}</td>
                    </tr>
                `;
            }).join('');

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö
            saveData();

            const totalElement = document.getElementById('multipleSummaryTotal');
            totalElement.textContent = formatCurrency(totalAll);
            if (totalAll < 0) {
                totalElement.classList.add('negative-amount');
            } else {
                totalElement.classList.remove('negative-amount');
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ
            document.getElementById('multipleSummarySection').style.display = 'block';
            
            // Scroll to table
            document.getElementById('multipleSummarySection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function selectAllEmployees() {
            const ids = Object.keys(employees);
            ids.forEach(id => {
                const checkbox = document.getElementById(`checkbox_${id}`);
                if (checkbox) checkbox.checked = true;
            });
        }

        // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function deselectAllEmployees() {
            const ids = Object.keys(employees);
            ids.forEach(id => {
                const checkbox = document.getElementById(`checkbox_${id}`);
                if (checkbox) checkbox.checked = false;
            });
        }

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
        function formatCurrency(amount) {
            return new Intl.NumberFormat('th-TH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount) + ' ‡∏ö‡∏≤‡∏ó';
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Export/Import ==========
        
        // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel
        function exportToExcel() {
            const ids = Object.keys(employees);
            if (ids.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }

            let csv = '‡∏ä‡∏∑‡πà‡∏≠,‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô,‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô,‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°,‡∏ß‡∏±‡∏ô‡∏•‡∏≤,‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤,‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô,‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÄ‡∏Å‡πà‡∏≤,‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢\n';
            
            ids.forEach(id => {
                const emp = employees[id];
                const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
                const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
                const totalSalary = emp.dailySalary * emp.workingDays;
                const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
                const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
                const previousNegative = emp.previousNegativeBalance || 0;
                const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
                const finalAmount = amountBeforeNegative - previousNegative;

                csv += `${emp.name},${emp.dailySalary},${emp.workingDays},${totalSalary},${emp.leaves.length},${leaveDeduction},${totalAdvance},${previousNegative},${finalAmount}\n`;
            });

            downloadFile(csv, '‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á.csv', 'text/csv');
        }

        // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô CSV
        function exportToCSV() {
            exportToExcel(); // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function backupData() {
            const data = {
                employees: employees,
                settings: {
                    defaultDailySalary: document.getElementById('defaultDailySalary').value,
                    defaultWorkingDays: document.getElementById('defaultWorkingDays').value,
                    notifyNegative: document.getElementById('notifyNegative').checked,
                    notifyOverAdvance: document.getElementById('notifyOverAdvance').checked
                },
                backupDate: new Date().toISOString()
            };
            
            const json = JSON.stringify(data, null, 2);
            downloadFile(json, `backup_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            alert('‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        // ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function restoreData() {
            document.getElementById('importModal').style.display = 'flex';
        }

        // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function confirmRestore() {
            const importText = document.getElementById('importData').value.trim();
            if (!importText) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON');
                return;
            }

            try {
                const data = JSON.parse(importText);
                if (confirm('‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    employees = data.employees || {};
                    if (data.settings) {
                        document.getElementById('defaultDailySalary').value = data.settings.defaultDailySalary || 500;
                        document.getElementById('defaultWorkingDays').value = data.settings.defaultWorkingDays || 30;
                        document.getElementById('notifyNegative').checked = data.settings.notifyNegative || false;
                        document.getElementById('notifyOverAdvance').checked = data.settings.notifyOverAdvance || false;
                        saveSettings();
                    }
                    saveData();
                    updateEmployeeList();
                    closeImportModal();
                    alert('‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
            } catch (e) {
                alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ' + e.message);
            }
        }

        // ‡∏õ‡∏¥‡∏î Modal
        function closeImportModal() {
            document.getElementById('importModal').style.display = 'none';
            document.getElementById('importData').value = '';
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Print ==========
        
        function printSummary() {
            if (!currentEmployeeId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            const printWindow = window.open('', '_blank');
            const emp = employees[currentEmployeeId];
            const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
            const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
            const totalSalary = emp.dailySalary * emp.workingDays;
            const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
            const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
            const previousNegative = emp.previousNegativeBalance || 0;
            const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
            const finalAmount = amountBeforeNegative - previousNegative;

            printWindow.document.write(`
                <html>
                    <head>
                        <title>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì - ${emp.name}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #667eea; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                            th { background: #667eea; color: white; }
                            .negative { color: red; font-weight: bold; }
                        </style>
                    </head>
                    <body>
                        <h1>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì - ${emp.name}</h1>
                        <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${new Date().toLocaleDateString('th-TH')}</p>
                        <table>
                            <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
                            <tr><td>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</td><td>${formatCurrency(emp.dailySalary)}</td></tr>
                            <tr><td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</td><td>${emp.workingDays} ‡∏ß‡∏±‡∏ô</td></tr>
                            <tr><td>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°</td><td>${formatCurrency(totalSalary)}</td></tr>
                            <tr><td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤</td><td>${emp.leaves.length} ‡∏ß‡∏±‡∏ô</td></tr>
                            <tr><td>‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</td><td>${formatCurrency(leaveDeduction)}</td></tr>
                            <tr><td>‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</td><td>${formatCurrency(totalAdvance)}</td></tr>
                            <tr><td>‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÄ‡∏Å‡πà‡∏≤</td><td class="${previousNegative > 0 ? 'negative' : ''}">${previousNegative > 0 ? formatCurrency(previousNegative) : '-'}</td></tr>
                            <tr><td><strong>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢</strong></td><td class="${finalAmount < 0 ? 'negative' : ''}"><strong>${formatCurrency(finalAmount)}</strong></td></tr>
                        </table>
                    </body>
                </html>
            `);
            printWindow.document.close();
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }

        // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function printAllSummary() {
            const ids = Object.keys(employees);
            if (ids.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á');
                return;
            }

            const printWindow = window.open('', '_blank');
            let htmlContent = `
                <html>
                    <head>
                        <title>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <style>
                            body { 
                                font-family: 'Sarabun', Arial, sans-serif; 
                                padding: 20px; 
                                font-size: 14px;
                            }
                            h1 { 
                                color: #667eea; 
                                text-align: center;
                                margin-bottom: 10px;
                            }
                            h2 {
                                color: #667eea;
                                border-bottom: 2px solid #667eea;
                                padding-bottom: 5px;
                                margin-top: 30px;
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse; 
                                margin: 20px 0; 
                                font-size: 12px;
                            }
                            th, td { 
                                border: 1px solid #ddd; 
                                padding: 8px; 
                                text-align: left; 
                            }
                            th { 
                                background: #667eea; 
                                color: white; 
                                font-weight: bold;
                            }
                            .negative { 
                                color: red; 
                                font-weight: bold; 
                            }
                            .summary-row {
                                display: flex;
                                justify-content: space-between;
                                padding: 5px 0;
                                border-bottom: 1px solid #eee;
                            }
                            .total-row {
                                font-weight: bold;
                                font-size: 16px;
                                color: #667eea;
                                margin-top: 10px;
                                padding-top: 10px;
                                border-top: 2px solid #667eea;
                            }
                            @media print {
                                body { margin: 0; padding: 10px; }
                                table { font-size: 11px; }
                                th, td { padding: 6px; }
                            }
                        </style>
                    </head>
                    <body>
                        <h1>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
                        <p style="text-align: center; color: #666;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
            `;

            let totalAll = 0;
            ids.forEach(id => {
                const emp = employees[id];
                const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
                const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
                const totalSalary = emp.dailySalary * emp.workingDays;
                const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
                const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
                const previousNegative = emp.previousNegativeBalance || 0;
                const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
                const finalAmount = amountBeforeNegative - previousNegative;
                totalAll += finalAmount;

                htmlContent += `
                    <h2>üë§ ${emp.name}</h2>
                    <table>
                        <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
                        <tr><td>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</td><td>${formatCurrency(emp.dailySalary)}</td></tr>
                        <tr><td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</td><td>${emp.workingDays} ‡∏ß‡∏±‡∏ô</td></tr>
                        <tr><td>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°</td><td>${formatCurrency(totalSalary)}</td></tr>
                        <tr><td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤</td><td>${fullDayLeaves + (halfDayLeaves * 0.5)} ‡∏ß‡∏±‡∏ô (‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô ${fullDayLeaves} ‡∏ß‡∏±‡∏ô, ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô ${halfDayLeaves} ‡∏ß‡∏±‡∏ô)</td></tr>
                        <tr><td>‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤</td><td>${formatCurrency(leaveDeduction)}</td></tr>
                        <tr><td>‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</td><td>${formatCurrency(totalAdvance)}</td></tr>
                        <tr><td>‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÄ‡∏Å‡πà‡∏≤</td><td class="${previousNegative > 0 ? 'negative' : ''}">${previousNegative > 0 ? formatCurrency(previousNegative) : '-'}</td></tr>
                        <tr><td><strong>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢</strong></td><td class="${finalAmount < 0 ? 'negative' : ''}"><strong>${formatCurrency(finalAmount)}</strong></td></tr>
                    </table>
                `;
            });

            htmlContent += `
                        <div class="total-row">
                            <div class="summary-row">
                                <span>üí∞ ‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                                <span class="${totalAll < 0 ? 'negative' : ''}">${formatCurrency(totalAll)}</span>
                            </div>
                        </div>
                    </body>
                </html>
            `;

            printWindow.document.write(htmlContent);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }

        // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function printCurrentPage() {
            window.print();
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Search/Filter ==========
        
        function filterEmployees() {
            const searchText = document.getElementById('searchEmployee').value.toLowerCase();
            const items = document.querySelectorAll('.employee-item');
            
            items.forEach(item => {
                const name = item.querySelector('.employee-name').textContent.toLowerCase();
                if (name.includes(searchText)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function filterHistory() {
            const filterMonth = document.getElementById('filterMonth').value;
            if (!currentEmployeeId) return;

            const emp = employees[currentEmployeeId];
            if (!emp.history) return;

            const tbody = document.getElementById('historyTableBody');
            const filtered = filterMonth 
                ? emp.history.filter(h => h.month.startsWith(filterMonth))
                : emp.history;

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="empty-state">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(record => {
                const leaveDaysText = record.halfDayLeaves > 0
                    ? `${record.totalLeaveDaysDecimal} ‡∏ß‡∏±‡∏ô (${record.fullDayLeaves} ‡∏ß‡∏±‡∏ô, ¬Ω${record.halfDayLeaves} ‡∏ß‡∏±‡∏ô)`
                    : `${record.totalLeaveDays} ‡∏ß‡∏±‡∏ô`;

                const amountClass = record.finalAmount < 0 ? 'negative-amount' : '';
                const previousNegativeClass = record.previousNegative > 0 ? 'negative-amount' : '';

                return `
                    <tr>
                        <td><strong>${record.monthName}</strong></td>
                        <td>${formatCurrency(record.dailySalary)}</td>
                        <td>${record.workingDays} ‡∏ß‡∏±‡∏ô</td>
                        <td>${formatCurrency(record.totalSalary)}</td>
                        <td>${leaveDaysText}</td>
                        <td>${formatCurrency(record.leaveDeduction)}</td>
                        <td>${formatCurrency(record.totalAdvance)}</td>
                        <td class="${previousNegativeClass}">${record.previousNegative > 0 ? formatCurrency(record.previousNegative) : '-'}</td>
                        <td class="${amountClass}" style="font-weight: bold;">${formatCurrency(record.finalAmount)}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteHistory(${record.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Statistics ==========
        
        function showStatistics() {
            document.getElementById('statisticsSection').style.display = 'block';
            updateStatistics();
        }

        function updateStatistics() {
            const year = document.getElementById('statYear').value;
            const empId = document.getElementById('statEmployee').value;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó dropdown ‡∏õ‡∏µ
            const yearSelect = document.getElementById('statYear');
            const currentYear = new Date().getFullYear();
            if (yearSelect.children.length <= 1) {
                for (let y = currentYear - 5; y <= currentYear + 1; y++) {
                    const option = document.createElement('option');
                    option.value = y;
                    option.textContent = y;
                    if (y == currentYear) option.selected = true;
                    yearSelect.appendChild(option);
                }
            }

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó dropdown ‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏á
            const empSelect = document.getElementById('statEmployee');
            const ids = Object.keys(employees);
            if (empSelect.children.length <= 1) {
                ids.forEach(id => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = employees[id].name;
                    empSelect.appendChild(option);
                });
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            let totalSalary = 0, totalAdvance = 0, totalLeave = 0, totalFinal = 0;
            let count = 0;

            ids.forEach(id => {
                if (empId && id != empId) return;
                const emp = employees[id];
                if (!emp.history) return;

                emp.history.forEach(record => {
                    if (year && !record.month.startsWith(year)) return;
                    totalSalary += record.totalSalary;
                    totalAdvance += record.totalAdvance;
                    totalLeave += record.leaveDeduction;
                    totalFinal += record.finalAmount;
                    count++;
                });
            });

            const content = document.getElementById('statisticsContent');
            if (count === 0) {
                content.innerHTML = '<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>';
                return;
            }

            content.innerHTML = `
                <div class="summary-card" style="margin-top: 20px;">
                    <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏£‡∏∏‡∏õ</h3>
                    <div class="summary-row">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span>
                        <span>${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="summary-row">
                        <span>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span>${formatCurrency(totalSalary)}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span>${formatCurrency(totalAdvance)}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏£‡∏ß‡∏°:</span>
                        <span>${formatCurrency(totalLeave)}</span>
                    </div>
                    <div class="summary-row">
                        <span>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°:</span>
                        <span class="${totalFinal < 0 ? 'negative-amount' : ''}">${formatCurrency(totalFinal)}</span>
                    </div>
                </div>
            `;
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Settings ==========
        
        function showSettings() {
            document.getElementById('settingsSection').style.display = 'block';
            loadSettings();
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            document.getElementById('defaultDailySalary').value = settings.defaultDailySalary || 500;
            document.getElementById('defaultWorkingDays').value = settings.defaultWorkingDays || 30;
            document.getElementById('notifyNegative').checked = settings.notifyNegative || false;
            document.getElementById('notifyOverAdvance').checked = settings.notifyOverAdvance || false;
        }

        function saveSettings() {
            const settings = {
                defaultDailySalary: parseFloat(document.getElementById('defaultDailySalary').value) || 500,
                defaultWorkingDays: parseFloat(document.getElementById('defaultWorkingDays').value) || 30,
                notifyNegative: document.getElementById('notifyNegative').checked,
                notifyOverAdvance: document.getElementById('notifyOverAdvance').checked
            };
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Clear Data ==========
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!')) {
                if (confirm('‚ö†Ô∏è‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á: ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    localStorage.clear();
                    employees = {};
                    currentEmployeeId = null;
                    location.reload();
                }
            }
        }

        // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Notifications ==========
        
        function checkNotifications() {
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            
            if (settings.notifyNegative) {
                Object.keys(employees).forEach(id => {
                    const emp = employees[id];
                    const fullDayLeaves = emp.leaves.filter(l => !(l.isHalfDay || l.type === 'halfday')).length;
                    const halfDayLeaves = emp.leaves.filter(l => l.isHalfDay || l.type === 'halfday').length;
                    const totalSalary = emp.dailySalary * emp.workingDays;
                    const leaveDeduction = (emp.dailySalary * fullDayLeaves) + (emp.dailySalary * 0.5 * halfDayLeaves);
                    const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
                    const previousNegative = emp.previousNegativeBalance || 0;
                    const amountBeforeNegative = totalSalary - leaveDeduction - totalAdvance;
                    const finalAmount = amountBeforeNegative - previousNegative;

                    if (finalAmount < 0) {
                        console.warn(`‚ö†Ô∏è ${emp.name} ‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö: ${formatCurrency(finalAmount)}`);
                    }
                });
            }

            if (settings.notifyOverAdvance) {
                Object.keys(employees).forEach(id => {
                    const emp = employees[id];
                    const totalSalary = emp.dailySalary * emp.workingDays;
                    const totalAdvance = emp.advances.reduce((sum, a) => sum + a.amount, 0);
                    
                    if (totalAdvance > totalSalary * 0.8) {
                        console.warn(`‚ö†Ô∏è ${emp.name} ‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 80% ‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${formatCurrency(totalAdvance)}`);
                    }
                });
            }
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            const advanceDate = document.getElementById('advanceDate');
            const leaveDate = document.getElementById('leaveDate');
            if (advanceDate) advanceDate.value = today;
            if (leaveDate) leaveDate.value = today;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        loadData();
        loadSettings();
        setTodayDate();

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
        setInterval(() => {
            if (Object.keys(employees).length > 0) {
                updateAllSummary();
                checkNotifications();
            }
        }, 2000);
    </script>
</body>
</html>
